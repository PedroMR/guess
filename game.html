<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<link rel="icon" type="image/x-icon" href="request.png">
<title>Guess What?</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,300;0,400;0,500;0,700&family=DM+Serif+Display:ital@0;1&display=swap" rel="stylesheet">
<style>
  :root {
    --gold: #C8A45C;
    --gold-dim: rgba(200,164,92,0.4);
    --gold-glow: rgba(200,164,92,0.12);
    --bg: #08080A;
    --surface: rgba(255,255,255,0.03);
    --border: rgba(255,255,255,0.07);
    --text: #E8E6E3;
    --text-dim: rgba(232,230,227,0.4);
    --green: #5CB870;
    --red: #D94F4F;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    font-family: 'DM Sans', system-ui, sans-serif;
    font-weight: 400;
    color: var(--text);
    min-height: 100dvh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 1rem;
    text-align: center;
    background: var(--bg);
    position: relative;
  }

  /* === Screen containers === */
  .screen {
    display: none;
    width: 100%;
    max-width: 400px;
    position: relative;
    z-index: 1;
  }
  .screen.active {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 1.1rem;
    animation: screenIn 0.3s ease-out;
  }
  @keyframes screenIn {
    from { opacity: 0; transform: translateY(8px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* === Typography === */
  h1 {
    font-family: 'DM Serif Display', Georgia, serif;
    font-size: 2.4rem;
    font-weight: 400;
    color: var(--gold);
    letter-spacing: -0.01em;
    margin-bottom: 0.2rem;
  }
  h2 {
    font-family: 'DM Serif Display', Georgia, serif;
    font-size: 1.6rem;
    font-weight: 400;
    color: var(--gold);
  }
  h3 { font-size: 1rem; color: var(--text-dim); font-weight: 400; }
  p { line-height: 1.6; color: var(--text-dim); font-weight: 300; font-size: 0.95rem; }

  /* === Buttons === */
  .btn {
    background: var(--gold);
    color: var(--bg);
    border: none;
    padding: 0.85rem 2rem;
    font-family: 'DM Sans', sans-serif;
    font-size: 1rem;
    font-weight: 700;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    border-radius: 6px;
    cursor: pointer;
    width: 100%;
    max-width: 300px;
    transition: transform 0.12s, opacity 0.12s;
    position: relative;
  }
  .btn:active {
    transform: scale(0.97);
    opacity: 0.85;
  }
  .btn.secondary {
    background: transparent;
    color: var(--text-dim);
    border: 1px solid var(--border);
  }
  .btn.secondary:active { border-color: rgba(255,255,255,0.15); }
  .btn.correct {
    background: var(--green);
    color: #fff;
  }
  .btn.skip {
    background: transparent;
    color: var(--text);
    border: 1px solid var(--gold-dim);
  }
  .btn.skip:active { border-color: var(--gold); }

  /* === Language checkboxes === */
  .language-option {
    display: flex;
    align-items: center;
    gap: 0.8rem;
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 0.85rem 1.2rem;
    border-radius: 6px;
    cursor: pointer;
    width: 100%;
    max-width: 300px;
    font-size: 1rem;
    font-weight: 300;
    transition: border-color 0.2s;
  }
  .language-option:active { border-color: rgba(255,255,255,0.15); }
  .language-option input {
    width: 18px;
    height: 18px;
    accent-color: var(--gold);
  }

  /* === Timer === */
  .timer {
    font-family: 'DM Serif Display', Georgia, serif;
    font-size: 3.2rem;
    font-weight: 400;
    font-variant-numeric: tabular-nums;
    color: var(--text);
  }
  .timer.warning {
    color: var(--red);
    animation: timerPulse 0.25s infinite alternate;
  }
  @keyframes timerPulse { to { opacity: 0.4; } }

  /* === Play card === */
  .card-box-wrapper {
    width: 100%;
    position: relative;
    overflow: hidden;
    border-radius: 8px;
    border: 1px solid var(--border);
  }
  /* Hide old book elements â€” repurpose as minimal card */
  .book-cover {
    position: relative;
    padding: 0;
    margin-left: 0;
    width: 100%;
    background: var(--surface);
    border-radius: 8px;
  }
  .brass-clasp { display: none; }
  .book-pages {
    position: relative;
    display: flex;
    gap: 0;
  }
  .book-pages::before,
  .book-pages::after { display: none; }
  .book-page-left { display: none; }
  .book-spine { display: none; }
  .card-box {
    flex: 1;
    position: relative;
    z-index: 1;
    border-radius: 8px;
    padding: 2rem 1.5rem;
    background: var(--surface);
    border: none;
    box-shadow: none;
  }
  .card-box::after { display: none; }
  .card-title {
    font-family: 'DM Serif Display', Georgia, serif;
    font-size: 1.7rem;
    font-weight: 400;
    color: var(--gold);
    margin-bottom: 0.8rem;
    text-shadow: none;
    position: relative;
    z-index: 1;
    line-height: 1.25;
  }
  .card-desc {
    font-size: 0.95rem;
    color: var(--text-dim);
    line-height: 1.7;
    font-family: 'DM Sans', sans-serif;
    font-weight: 300;
    position: relative;
    z-index: 1;
    text-align: left;
  }
  .card-points {
    margin-top: 0.8rem;
    font-size: 0.8rem;
    color: rgba(200,164,92,0.5);
    font-style: normal;
    font-family: 'DM Sans', sans-serif;
    font-weight: 500;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    position: relative;
    z-index: 1;
  }

  /* === Round badge === */
  .round-badge {
    background: transparent;
    border: 1px solid var(--gold-dim);
    color: var(--gold);
    padding: 0.25rem 0.9rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.08em;
    text-transform: uppercase;
  }
  .round-rule {
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 1rem;
    border-radius: 6px;
    width: 100%;
  }

  /* === Closed book / ready & confirm screens === */
  .book-closed {
    width: 100%;
    max-width: 400px;
    position: relative;
    border-radius: 8px;
    padding: 2.5rem 1.8rem;
    background: var(--surface);
    border: 1px solid var(--border);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.8rem;
    text-align: center;
  }
  .book-closed::before,
  .book-closed::after { display: none; }
  .book-closed .brass-clasp { display: none; }
  .book-closed-frame { display: none; }
  .book-closed-title {
    font-family: 'DM Serif Display', Georgia, serif;
    font-size: 2rem;
    font-weight: 400;
    color: var(--gold);
    text-shadow: none;
    position: relative;
    z-index: 1;
    margin-top: 0.3rem;
    line-height: 1.2;
  }
  .book-closed-subtitle {
    font-family: 'DM Sans', sans-serif;
    font-size: 0.95rem;
    font-style: normal;
    color: var(--text-dim);
    line-height: 1.6;
    font-weight: 300;
    position: relative;
    z-index: 1;
    padding: 0;
  }
  .book-closed-round {
    font-family: 'DM Sans', sans-serif;
    font-size: 0.75rem;
    color: var(--gold-dim);
    font-style: normal;
    font-weight: 700;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    position: relative;
    z-index: 1;
  }
  .book-closed-divider {
    width: 40px;
    height: 1px;
    background: var(--border);
    position: relative;
    z-index: 1;
  }
  .book-closed-divider::before { display: none; }

  /* === Summary items === */
  .summary-item {
    display: flex;
    justify-content: space-between;
    padding: 0.6rem 0;
    border-bottom: 1px solid var(--border);
    width: 100%;
    font-weight: 300;
    font-size: 0.95rem;
  }
  .summary-item .guessed {
    color: var(--green);
    font-weight: 500;
  }
  .summary-item .skipped { color: var(--text-dim); }

  .deck-info {
    color: var(--text-dim);
    font-size: 0.85rem;
    font-weight: 300;
  }

  /* === Back button === */
  .btn-back {
    background: none;
    border: none;
    color: var(--text-dim);
    font-family: 'DM Sans', sans-serif;
    font-size: 0.8rem;
    font-weight: 400;
    cursor: pointer;
    padding: 0.4rem 0;
    transition: color 0.2s;
    letter-spacing: 0.03em;
  }
  .btn-back:active { color: var(--text); }

  /* === Screen-specific panels === */
  #setup.active {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 2rem 1.2rem;
  }
  #summary.active,
  #gameover.active {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 1.5rem 1.2rem;
  }

  .sticky-bottom {
    position: sticky;
    bottom: 0px;
  }
</style>
</head>
<body>

<!-- SETUP SCREEN -->
<div id="setup" class="screen active">
  <h1>Guess What?</h1>
  <p>Choose which languages to include:</p>
  <label class="language-option"><input type="checkbox" value="all" id="lang-all" checked> All</label>
  <label class="language-option"><input type="checkbox" value="en" id="lang-en"> English</label>
  <label class="language-option"><input type="checkbox" value="br" id="lang-br"> Brazilian Portuguese</label>
  <p id="card-count" class="deck-info"></p>
  <button class="btn" id="start-game-btn">Start Game</button>
</div>

<!-- READY SCREEN -->
<div id="ready" class="screen">
  <div class="book-closed">
    <span class="brass-clasp top-left"></span>
    <span class="brass-clasp top-right"></span>
    <span class="brass-clasp bottom-left"></span>
    <span class="brass-clasp bottom-right"></span>
    <div class="book-closed-frame"></div>
    <div class="book-closed-round" id="ready-round"></div>
    <div class="book-closed-divider"></div>
    <div class="book-closed-title">Ready for<br>Next Turn!</div>
    <div class="book-closed-divider"></div>
    <div class="book-closed-subtitle" id="ready-rule"></div>
    <div class="book-closed-divider"></div>
    <div class="book-closed-round" id="ready-deck-info"></div>
  </div>
  <button class="btn" id="start-turn-btn">Start Turn</button>
  <button class="btn-back" id="back-ready-btn">Back to Menu</button>
</div>

<!-- PLAY SCREEN -->
<div id="play" class="screen">
  <div style="display:flex;justify-content:space-between;align-items:center;width:100%;">
    <span class="round-badge" id="play-round"></span>
    <span class="timer" id="timer">60</span>
  </div>
  <!--div class="round-rule" id="play-rule" style="font-size:0.85rem;padding:0.5rem 0.8rem;"></div-->
  <div class="card-box-wrapper">
    <div class="book-cover">
      <span class="brass-clasp top-right"></span>
      <span class="brass-clasp bottom-right"></span>
      <div class="book-pages">
        <div class="book-page-left"></div>
        <div class="book-spine"></div>
        <div class="card-box">
          <div class="card-title" id="card-title"></div>
          <div class="card-desc" id="card-desc"></div>
          <div class="card-points" id="card-points"></div>
        </div>
      </div>
    </div>
  </div>
  <button class="btn correct" id="guessed-btn">Correct!</button>
  <button class="btn skip" id="skip-btn">Skip</button>
  <button class="btn-back" id="back-play-btn">Back to Menu</button>
</div>

<!-- TURN SUMMARY SCREEN -->
<div id="summary" class="screen">
  <h2>Turn Over!</h2>
  <div id="summary-list" style="width:100%;"></div>
  <p id="summary-total" style="font-size:1.2rem;font-weight:bold;"></p>
  <button class="btn sticky-bottom" id="summary-continue-btn">Continue</button>
</div>

<!-- CONFIRM QUIT SCREEN -->
<div id="confirm-quit" class="screen">
  <div class="book-closed">
    <span class="brass-clasp top-left"></span>
    <span class="brass-clasp top-right"></span>
    <span class="brass-clasp bottom-left"></span>
    <span class="brass-clasp bottom-right"></span>
    <div class="book-closed-frame"></div>
    <div class="book-closed-round">Leaving so soon?</div>
    <div class="book-closed-divider"></div>
    <div class="book-closed-title">Are You<br>Sure?</div>
    <div class="book-closed-divider"></div>
    <div class="book-closed-subtitle">You will lose all of your progress.</div>
    <div class="book-closed-divider"></div>
  </div>
  <button class="btn" id="confirm-quit-yes">Yes, I'm sure!</button>
  <button class="btn secondary" id="confirm-quit-no">Nevermind</button>
</div>

<!-- GAME OVER SCREEN -->
<div id="gameover" class="screen">
  <h1>Game Over!</h1>
  <p>You guessed all the cards across all 3 rounds!</p>
  <button class="btn" id="play-again-btn">Play Again</button>
</div>

<script>
const TURN_DURATION = 60;
const DECK_SIZE = 30;
const ROUND_RULES = [
  'Round 1: Say anything you want &mdash; just don\'t use words from the title!',
  'Round 2: Say only ONE word &mdash; and it can\'t be from the title!',
  'Round 3: No talking! Mime it out!'
];

const allCards = [
  {title:"King Lear",description:"Shakesperean regent who divides his kingdom across his daughters Goneril, Regan, and Cordelia.",points:3,language:"en"},
  {title:"Narizinho",description:"Personagem principal nas historias de Monteiro Lobato sobre o S\u00edtio do Picapau-Amarelo, \u00e9 peralta e tem seu nome vindo de parte de sua anatomia que \u00e9 famosa por ser arrebitada.",points:4,language:"br"},
  {title:"E.T.",description:"Movie named after its main character which is an alien that gets lost on Earth and is helped by a number of children including one played by Reese Whiterspoon. He heals Elliot with his finger and they fly in their bycicles.",points:2,language:"en"},
  {title:"Percy Jackson",description:"Main character in a book where he is accused of stealing Zeus's lightning. He then goes on a road trip to prove his innocence and save his mother.",points:2,language:"en"},
  {title:"Calliope",description:"One of the muses. In Neil Gaiman's Sandman stories she has a child with the main character, the ill-fated lyre-playing Orpheus.",points:4,language:"en"},
  {title:"Moloko",description:"Esta palavra significa 'leite' em Russo, \u00e9 o nome de uma banda que o papai gosta, e descreve drogas no livro 'Laranja Mec\u00e2nica' de Alexander Burguess.",points:5,language:"br"},
  {title:"Ted Danson",description:"Tall actor who played characters in Cheers, A Good Place and Man on the Inside.",points:3,language:"en"},
  {title:"Marie Antoinette",description:"A French aristocrat known for her elaborate silk gowns and even taller hair-dos who famously said 'Let them eat cake' when asked 'the people have no bread to eat.'",points:3,language:"en"},
  {title:"Noite Estrelada",description:"Obra famosa por suas grossas pinceladas de Vincent Van Gogh representando o que via nos c\u00e9us.",points:2,language:"br"},
  {title:"Mona Lisa",description:"O quadro mais famoso do mundo, tamb\u00e9m conhecido como La Gioconda, pintado por Leonardo DaVinci. Atualmente exposta no Louvre, em Paris.",points:1,language:"br"},
  {title:"Marion",description:"Caso rom\u00e2ntico mais famosa do arque\u00f3logo Indiana Jones, ela consegue segurar sua bebida e disparou as metralhadoras de um avi\u00e3o em que ficou presa.",points:3,language:"br"},
  {title:"Sonic the Hedgehog",description:"Blue rodent who can run really fast in his videogames, his film became famous for its weird presentation of his teeth.",points:3,language:"en"},
  {title:"Double Rainbow",description:"Meme famous after the person filming this video captured two of an optical effect in the sky and couldn't stop saying this phrase. What does it mean?",points:2,language:"en"},
  {title:"Weird Al Yankovic",description:"Singer/songwriter famous for writing parody versions of famous songs, including such hits as 'Like a Surgeon' and 'Amish Paradise'. A polka lover!",points:2,language:"en"},
  {title:"Dungeon Master",description:"When playing the famous RPG 'Dungeons & Dragons', this person has the role of describing the world around the players and adjudicating play as a whole.",points:2,language:"en"},
  {title:"Metamorphosis",description:"Tale by author Franz Kafka that starts when Gregor Samsa finds himself turned into a monstrous insect.",points:3,language:"en"},
  {title:"Final Fantasy",description:"Series of videogames created in Japan which became famous as one of the most recognized JRPG brands ever. They usually hinge around crystals, Chocobos, and feature a mechanic named Cid.",points:1,language:"en"},
  {title:"Origami",description:"Japanese art of folding paper to create interesting effects. Its most famous creation is undoubtedly the crane.",points:1,language:"en"},
  {title:"iPhone Charger",description:"This contraption used to have a lightning connector but changed to USB-C; it's important for powering your mobile device but is never around when we need one.",points:2,language:"en"},
  {title:"Minotaur",description:"Conceived by Queen Pasiphae and a bull, King Minos hid this mythical monster in a maze constructed by Daedalus until it was defeated by Theseus.",points:2,language:"en"},
  {title:"Do Not Disturb Sign",description:"Hanged outside a hotel door it asks cleaning staff to not knock and come back later.",points:2,language:"en"},
  {title:"Fish Extender",description:"Consisting of pockets hanging beside a door, it asks other passengers in the Disney Cruise to leave small gifts and souvenirs inside.",points:4,language:"en"},
  {title:"White Rabbit",description:"In the story of Alice in Wonderland, this curious rodent was always in a hurry, worried about making the Queen wait lest he lost his head.",points:2,language:"en"},
  {title:"Pac-Man's Ghosts",description:"Four villains in the dark maze full of small pills that the player of a famous video-game had to traverse, guiding a yellow circle.",points:3,language:"en"},
  {title:"Perry the Platypus",description:"A pet in the Phineas & Ferb cartoon, this marsupial is actually a globe-trotting secret agent in disguise, always fighting his nemesis Dr. Heinz Doofenshmirtz.",points:2,language:"en"},
  {title:"Jet Lag",description:"The feeling we get after crossing too many time zones at once, this will hinder your sleep schedule.",points:1,language:"en"},
  {title:"Black Lotus",description:"The most famous card in Magic: The Gathering, this is banned in tournament play due to low cost and overly powerful ability. It represents a dark flower.",points:3,language:"en"},
  {title:"Palantir",description:"This orb was used by Sauron to communicate with his servants, including Saruman, who lost his sphere when Gr\u00edma threw it down from Orthanc.",points:3,language:"en"},
  {title:"Milk Teeth",description:"Kids use these to chew their food, even if they are bound to lose them later when the new adult ones come in",points:1,language:"en"},
  {title:"Calvin's Stuffed Tiger (Hobbes)",description:"The favoured pet and eternal best friend of an elementary-level menace who was portrayed in the famous comic strips with both their names, along with Susie, Mom and Dad.",points:3,language:"en"},
  {title:"Sa\u00fade!",description:"O que a gente diz quando algu\u00e9m espirra, originalmente desejando que sua alma n\u00e3o saia do seu corpo com o espirro.",points:1,language:"br"},
  {title:"As Tr\u00eas Leis da Rob\u00f3tica",description:"Criadas por Isaac Asimov, estas regras governam o comportamento dos rob\u00f4s.",points:2,language:"br"},
  {title:"(Pie) \u00e0 la Mode",description:"French expression for a wonderful combination of two desserts, this literally means a fashionable dessert.",points:2,language:"en"},
  {title:"Golf",description:"Chamado de esporte por alguns, esta atividade concentra-se ao redor de bater forte numa bolinha com um taco.",points:1,language:"br"},
  {title:"Mammal",description:"An animal with fur that doesn't lay eggs. Their name comes from the act of suckling an infant in one's teats.",points:1,language:"en"},
  {title:"Darth-Maul's Lightsaber",description:"An elegant weapon for a more civilized age, this double-sided blade was wielded by a red and black Zabrak that followed the Sith.",points:3,language:"en"},
  {title:"\u00c1lbum de Fotos de Viagem",description:"Uma cole\u00e7\u00e3o de imagens capturadas por um telefone ou c\u00e2mera arrumadas em um livro mostrando os trejeitos e trajetos das pessoas que passaram tempo juntas em um outro lugar.",points:3,language:"br"},
  {title:"Link's Master Sword",description:"Famous weapon wielded by a green-clad hero that strives to save Princess Zelda from various evils in a series of video-games by Nintendo.",points:3,language:"en"},
  {title:"An HDMI Cable",description:"Connector used to plug a monitor into a computer, or a home theater to a TV set. Supports the copyright protection protocol HDCP.",points:2,language:"en"},
  {title:"That Loving Feeling",description:"Thing you've lost, according to the 1964 song by The Righteous Brothers, performed by Tom Cruise in Top Gun.",points:4,language:"en"},
  {title:"Narnia",description:"Land of the Lion, the Witch and the Wardrobe, where the four Pevensie live their adventures.",points:2,language:"en"},
  {title:"The Chicken or the Egg?",description:"Eternal quandary revolving around whether the animal or the container from which it's born came first.",points:3,language:"en"},
  {title:"Brandon Sanderson",description:"Famous author of the Stormlight Archive and Mistborn, among others, his works often thread the line between Sci-Fi and Fantasy.",points:3,language:"en"},
  {title:"Bird of Prey",description:"Type of winged creature that eats live meat, and also the name of the most famous Klingon warships.",points:2,language:"en"},
  {title:"Pesach",description:"Famous Jewish holiday that commemorates the exit of the Hebrews from Egypt. Its name comes from the passing of death over the doors that belonged to the slaves.",points:3,language:"en"},
  {title:"LNG (Liquid Natural Gas)",description:"Sigla representando a principal commodity que a mam\u00e3e cobre em seu trabalho (mas n\u00e3o a \u00fanica).",points:3,language:"br"},
  {title:"Samurai Siege",description:"Primeiro jogo de sucesso da Space Ape Games, trazendo uma est\u00e9tica japonesa para o g\u00eanero de 'constr\u00f3i e ataca' popularizado por Clash of Clans.",points:3,language:"br"}
];
let filteredCards = [];
let gameDeck = [];    // the full deck for the game (DECK_SIZE cards)
let roundDeck = [];   // remaining cards this round
let currentCard = null;
let round = 1;
let timerInterval = null;
let timeLeft = 0;
let turnResults = []; // {card, guessed}

function loadCards() {
  updateCardCount();
}

// --- Language Selection ---
const langAll = document.getElementById('lang-all');
const langEn = document.getElementById('lang-en');
const langBr = document.getElementById('lang-br');

langAll.addEventListener('change', () => {
  if (langAll.checked) { langEn.checked = false; langBr.checked = false; }
  updateCardCount();
});
langEn.addEventListener('change', () => {
  if (langEn.checked || langBr.checked) langAll.checked = false;
  if (!langEn.checked && !langBr.checked) langAll.checked = true;
  updateCardCount();
});
langBr.addEventListener('change', () => {
  if (langEn.checked || langBr.checked) langAll.checked = false;
  if (!langEn.checked && !langBr.checked) langAll.checked = true;
  updateCardCount();
});

function getFilteredCards() {
  if (langAll.checked) return [...allCards];
  const langs = [];
  if (langEn.checked) langs.push('en');
  if (langBr.checked) langs.push('br');
  return allCards.filter(c => langs.includes(c.language));
}

function updateCardCount() {
  filteredCards = getFilteredCards();
  const el = document.getElementById('card-count');
  el.textContent = `${filteredCards.length} cards available (${DECK_SIZE} will be selected)`;
  document.getElementById('start-game-btn').disabled = filteredCards.length < DECK_SIZE;
}

// --- Screen Management ---
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

// --- Shuffle ---
function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

// --- Game Start ---
document.getElementById('start-game-btn').addEventListener('click', () => {
  filteredCards = getFilteredCards();
  if (filteredCards.length < DECK_SIZE) return;
  gameDeck = shuffle([...filteredCards]).slice(0, DECK_SIZE);
  round = 1;
  startRound();
});

function startRound() {
  roundDeck = shuffle([...gameDeck]);
  showReadyScreen();
}

function showReadyScreen() {
  document.getElementById('ready-round').textContent = `Round ${round} of 3`;
  document.getElementById('ready-rule').innerHTML = ROUND_RULES[round - 1];
  document.getElementById('ready-deck-info').textContent =
    `${roundDeck.length} of ${gameDeck.length} cards remaining in deck`;
  showScreen('ready');
}

// --- Turn ---
document.getElementById('start-turn-btn').addEventListener('click', startTurn);

function startTurn() {
  turnResults = [];
  timeLeft = TURN_DURATION;
  showScreen('play');
  document.getElementById('play-round').textContent = `Round ${round}`;
  if (document.getElementById('play-rule'))
    document.getElementById('play-rule').innerHTML = ROUND_RULES[round - 1];
  updateTimer();
  drawCard();
  timerInterval = setInterval(() => {
    timeLeft--;
    updateTimer();
    if (timeLeft <= 0) 
    {
      // if time is over skip the current card
      if (currentCard != null)
      {
        roundDeck.pop();
        roundDeck.unshift(currentCard);
      }
      endTurn();
    }
  }, 1000);
}

function updateTimer() {
  const el = document.getElementById('timer');
  el.textContent = timeLeft;
  el.classList.toggle('warning', timeLeft <= 10);
}

function drawCard() {
  if (roundDeck.length === 0) {
    endTurn();
    return;
  }
  currentCard = roundDeck[roundDeck.length - 1];
  document.getElementById('card-title').textContent = currentCard.title;
  document.getElementById('card-desc').textContent = currentCard.description;
  document.getElementById('card-points').textContent = `${currentCard.points} point${currentCard.points !== 1 ? 's' : ''}`;
}

document.getElementById('guessed-btn').addEventListener('click', () => {
  if (!currentCard) return;
  roundDeck.pop();
  turnResults.push({ card: currentCard, guessed: true });
  currentCard = null;
  if (roundDeck.length === 0) {
    endTurn();
  } else {
    drawCard();
  }
});

document.getElementById('skip-btn').addEventListener('click', () => {
  if (!currentCard) return;
  // Move current card to front of deck (bottom of stack) so it comes back later
  roundDeck.pop();
  roundDeck.unshift(currentCard);
  turnResults.push({ card: currentCard, guessed: false });
  currentCard = null;
  drawCard();
});

function endTurn() {
  clearInterval(timerInterval);
  currentCard = null;
  showTurnSummary();
}

// --- Turn Summary ---
function showTurnSummary() {
  const list = document.getElementById('summary-list');
  list.innerHTML = '';
  let guessedCount = 0;
  for (const r of turnResults) {
    const div = document.createElement('div');
    div.className = 'summary-item';
    div.innerHTML = `<span>${r.card.title}</span><span class="${r.guessed ? 'guessed' : 'skipped'}">${r.guessed ? 'Guessed' : 'Skipped'}</span>`;
    list.appendChild(div);
  }
  guessedCount = turnResults.filter(r => r.guessed).length;
  document.getElementById('summary-total').textContent = `${guessedCount} card${guessedCount !== 1 ? 's' : ''} guessed this turn`;
  showScreen('summary');
}

document.getElementById('summary-continue-btn').addEventListener('click', () => {
  if (roundDeck.length === 0) {
    // Round complete
    if (round >= 3) {
      showScreen('gameover');
    } else {
      round++;
      startRound();
    }
  } else {
    showReadyScreen();
  }
});

// --- Play Again ---
document.getElementById('play-again-btn').addEventListener('click', () => {
  showScreen('setup');
  updateCardCount();
});

// --- Back to Menu ---
let returnScreen = null;

document.getElementById('back-ready-btn').addEventListener('click', () => {
  returnScreen = 'ready';
  showScreen('confirm-quit');
});

document.getElementById('back-play-btn').addEventListener('click', () => {
  returnScreen = 'play';
  clearInterval(timerInterval);
  showScreen('confirm-quit');
});

document.getElementById('confirm-quit-yes').addEventListener('click', () => {
  returnScreen = null;
  currentCard = null;
  showScreen('setup');
  updateCardCount();
});

document.getElementById('confirm-quit-no').addEventListener('click', () => {
  if (returnScreen === 'play') {
    showScreen('play');
    timerInterval = setInterval(() => {
      timeLeft--;
      updateTimer();
      if (timeLeft <= 0) endTurn();
    }, 1000);
  } else {
    showScreen(returnScreen || 'ready');
  }
  returnScreen = null;
});

// --- Init ---
loadCards();
</script>
</body>
</html>
